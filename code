=======================================
INICIO FICHERO >> ./makefile.dev
=======================================
# Makefile para desarrollo local de QA App con Playwright y Dashboard de selectores

install:
	docker compose run --rm backend sh -c "npm install"
	docker compose run --rm frontend sh -c "npm install"
	docker compose run --rm dashboard sh -c "npm install"
	docker compose run --rm dashboard sh -c "npm install --prefix ./e2e playwright && npx playwright install --with-deps"

dev: build install
	docker compose up -d
	docker compose logs -f

build:
	docker compose build

stop:
	docker compose down

restart:
	@echo "ðŸ”„ Reiniciando contenedores sin reconstruir..."
	docker compose down
	docker compose up -d
	docker compose logs -f

depack:
	python d.py code      

cleanAll:
	docker compose down -v --remove-orphans
	lsof -t -i tcp:3001 | xargs kill || true
	docker compose down --volumes
	rm -rf node_modules package-lock.json
	docker system prune -af --volumes

# ðŸš€ Nuevo comando: build + install + up + logs (build limpio)
dev-all:
	@echo "ðŸ”„ Construyendo imÃ¡genes y reinstalando dependencias..."
	docker compose build --no-cache
	docker compose run --rm backend sh -c "npm install"
	docker compose run --rm frontend sh -c "npm install"
	docker compose run --rm dashboard sh -c "npm install"
	docker compose run --rm dashboard sh -c "npm install --prefix ./e2e playwright && npx playwright install --with-deps"
	@echo "ðŸš€ Levantando todos los servicios..."
	docker compose up -d
	@echo "ðŸ“œ Mostrando logs..."
	docker compose logs -f

# âš¡ Arranque rÃ¡pido sin reconstruir imÃ¡genes
start:
	@echo "âš¡ Arranque rÃ¡pido con imÃ¡genes ya construidas..."
	docker compose up -d
	docker compose logs -f

# ðŸ§ª Ejecutar tests E2E de Playwright
test-e2e:
	@echo "ðŸ§ª Ejecutando tests E2E con Playwright..."
	docker compose run --rm dashboard sh -c "cd e2e && npx playwright test"

# ðŸ› ï¸ Ejecutar autoheal y registrar cambios
test-autoheal:
	@echo "ðŸ› ï¸ Ejecutando Autoheal de selectores..."
	docker compose run --rm dashboard sh -c "node ./autoheal/run_autoheal.js && echo 'Cambios registrados en tests_info.db'"
=======================================
FIN FICHERO >> ./makefile.dev
=======================================
